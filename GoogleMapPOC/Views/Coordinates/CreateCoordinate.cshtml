@model GoogleMapPOC.Model.Coordinates

@{
    ViewBag.Title = "CreateCoordinate";
}

<h2>Create Coordinates</h2>
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>CreateCoordinate</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    @* <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLmAsqUWLWWdhPVkoKAmgZwPOc8BMHWAA"></script>*@
    @*<script type="text/javascript"
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkUOdZ5y7hMm0yrcCQoCvLwzdM6M8s5qk&callback=initMap">
        </script>*@
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/scripts/jquery-3.3.1.min.js"></script>
    <script src="~/scripts/bootstrap.min.js"></script>
    <script src="~/scripts/jquery.validate.min.js"></script>
    <script src="~/scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="http://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script type="text/javascript">

        var markers = @Html.Raw(ViewBag.Marker)
            function initialize() {
                var mapOptions = {
                    center: new google.maps.LatLng(32.78, -96.81),
                    zoom: 13,
                    mapTypeId: google.maps.MapTypeId.TERRAIN
                };

                // var infoWindow = new google.maps.InfoWindow();
                var map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);

                var polyOptions = new google.maps.Polyline({
                    geodesic: true,
                    strokeColor: 'rgb(20,120,218)',
                    strokeOpacity: 1.0,
                    strokeWeight: 2,
                    editable: true
                });
                // var poly = new google.map.Polyline(polyOptions);
                polyOptions.setMap(map);

                google.maps.event.addListener(map, "click", function (event) {
                    var path = polyOptions.getPath();
                    path.push(event.latLng);

                    var coordinates_poly = polyOptions.getPath().getArray();
                    var newCoordinates_poly = [];

                    for (var i = 0; i < coordinates_poly.length; i++) {
                        markers.lat = coordinates_poly[i].lat();
                        markers.lng = coordinates_poly[i].lng();

                        latlng_poly = [markers.lat, markers.lng];
                        newCoordinates_poly.push(latlng_poly);
                        console.log(latlng_poly);
                    }


                    var str_coordinates_poly = JSON.stringify(newCoordinates_poly);
                    var json_poly = "(\"Coordinates\":" + str_coordinates_poly + ")";

                    document.getElementById("json_polyline").value = json = json_poly;
                    console.log(newCoordinates_poly);

                    $.ajax({
                        url: "/Coordinates/CreateCoordinate",
                        type: "POST",
                        data: {
                            Latitude: markers.lat,
                            Longitude: markers.lng
                        },
                       // contentType: 'application/json; charset=utf-8',
                        success: function (result) {
                            alert(result.success);
                            console.log(result);
                        },
                        error: function () {
                            alert("error");
                        }
                    });
                });


            };
            
            

        google.maps.event.addDomListener(window, 'load', initialize);

        
           
    </script>
</head>
<body>
    <div id="dvMap" class="card" style="width: 100%; height: 400px">
    </div>
    <textarea id="json_polyline" style='height:10%;width:100%'></textarea>
    @*<button type="button" class="btn btn-primary" id="btnAdd" onclick="Add()">Add</button>*@
</body>
</html>
